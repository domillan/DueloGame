<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duelo de Palavras</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --target-color: #00e676; /* Verde Neon */
            --forbidden-color: #ff1744; /* Vermelho Neon */
            --btn-skip: #424242;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }

        /* --- CABEÃ‡ALHO --- */
        header {
            width: 100%;
            max-width: 500px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }

        h1 { font-size: 1.1rem; font-weight: 700; letter-spacing: 1px; }
        .counter { font-size: 0.9rem; color: #aaa; }

        /* --- CARTÃƒO DO JOGO --- */
        .game-card {
            width: 100%;
            max-width: 450px;
            background-color: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
            animation: slideIn 0.3s ease-out;
        }

        /* Metade Superior: ALVO */
        .section-target {
            background: linear-gradient(135deg, #1b5e20 0%, #004d40 100%);
            padding: 30px 20px;
            text-align: center;
            border-bottom: 4px solid var(--bg-color);
            position: relative;
        }

        .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.8;
            margin-bottom: 5px;
            display: block;
        }

        .word-target {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--target-color);
            text-transform: uppercase;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Metade Inferior: PROIBIDA */
        .section-forbidden {
            background: linear-gradient(135deg, #3e1c1c 0%, #4a1010 100%);
            padding: 25px 20px;
            text-align: center;
            position: relative;
        }

        .icon-ban {
            font-size: 1.5rem;
            margin-bottom: 5px;
            display: block;
        }

        .word-forbidden {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--forbidden-color);
            text-transform: uppercase;
		text-shadow: 0 2px 4px rgba(0,0,0,0.3);

        }

        /* --- BOTÃ•ES --- */
        .controls {
            display: flex;
            gap: 15px;
            width: 100%;
            max-width: 450px;
            margin-bottom: 30px;
        }

        .btn {
            flex: 1;
            border: none;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: transform 0.1s;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:active { transform: scale(0.95); }

        .btn-skip {
            background-color: var(--btn-skip);
            box-shadow: 0 4px 0 #212121;
        }

        .btn-correct {
            background-color: var(--target-color);
            color: #003300;
            box-shadow: 0 4px 0 #00b34a;
        }

        .btn-reset {
            background: transparent;
            border: 1px solid #555;
            color: #777;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        /* --- HISTÃ“RICO --- */
        .history-container {
            width: 100%;
            max-width: 450px;
            border-top: 1px solid #333;
            padding-top: 15px;
        }

        .history-title {
            font-size: 0.85rem;
            color: #888;
            text-transform: uppercase;
            text-align: center;
            margin-bottom: 10px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #252525;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .h-words { display: flex; flex-direction: column; }
        .h-main { font-weight: bold; color: white; }
        .h-sub { font-size: 0.75rem; color: #777; }
        
        .status-indicator {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        .status-ok { color: var(--target-color); border: 1px solid var(--target-color); }
        .status-fail { color: var(--forbidden-color); border: 1px solid var(--forbidden-color); }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hidden { display: none; }
        .game-over { text-align: center; padding: 40px; color: #888; }

    </style>
</head>
<body>

    <header>
        <h1>DUELO DE PALAVRAS</h1>
        <div class="counter">Restantes: <span id="count-val">--</span></div>
        <button class="btn-reset" onclick="resetStorage()">ðŸ”„ Resetar</button>
    </header>

    <div id="game-area" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        
        <div class="game-card">
            <div class="section-target">
                <span class="label">Acerte esta palavra:</span>
                <div class="word-target" id="word-target">...</div>
            </div>
            <div class="section-forbidden">
                <span class="icon-ban">ðŸš« Palavra proibida:</span>
                <div class="word-forbidden" id="word-forbidden">...</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-skip" onclick="handleResult(false)">
                âœ– Pular / Errou
            </button>
            <button class="btn btn-correct" onclick="handleResult(true)">
                âœ” Acertou
            </button>
        </div>

    </div>

    <div id="game-over" class="game-over hidden">
        <h2>Fim das cartas!</h2>
        <p>VocÃª completou todas as 300 duplas.</p>
    </div>

    <div class="history-container">
        <div class="history-title">HistÃ³rico da SessÃ£o</div>
        <div id="history-list" class="history-list">
            </div>
    </div>

    <script>
        const STORAGE_KEY = 'duelo_palavras_ids';
        // --- VARIÃVEIS DE ESTADO ---
        let playedIds = [];
        let availablePairs = [];
        let currentPair = null; // Vai guardar o objeto jÃ¡ sorteado (podendo ter t e f invertidos)

        // Elementos DOM
        const elTarget = document.getElementById('word-target');
        const elForbidden = document.getElementById('word-forbidden');
        const elCount = document.getElementById('count-val');
        const elHistory = document.getElementById('history-list');
        const elGameArea = document.getElementById('game-area');
        const elGameOver = document.getElementById('game-over');

        function init() {
            // Carregar IDs jÃ¡ jogados
            const stored = localStorage.getItem(STORAGE_KEY);
            playedIds = stored ? JSON.parse(stored) : [];

            calculateAvailable();
            nextRound();
        }

        function calculateAvailable() {
            availablePairs = db.filter(item => !playedIds.includes(item.id));
            updateCounter();
        }

        function updateCounter() {
            elCount.textContent = availablePairs.length;
        }

        function nextRound() {
            if (availablePairs.length === 0) {
                showGameOver();
                return;
            }

            // Sorteio do par
            const randomIndex = Math.floor(Math.random() * availablePairs.length);
            const basePair = availablePairs[randomIndex];

            // Sorteio da ordem (50% de chance de inverter)
            const flip = Math.random() < 0.5;

            // Cria um objeto temporÃ¡rio para esta rodada
            currentPair = {
                id: basePair.id,
                t: flip ? basePair.t : basePair.f, // Se flip=true, t=t. Se false, t=f (inverte)
                f: flip ? basePair.f : basePair.t
            };

            // Renderizar
            elTarget.textContent = currentPair.t;
            elForbidden.textContent = currentPair.f;
        }

        function handleResult(isCorrect) {
            if (!currentPair) return;

            // 1. Adicionar ao histÃ³rico visual
            addToHistory(currentPair, isCorrect);

            // 2. Salvar ID como jogado (salva o ID original do par, independente da ordem mostrada)
            playedIds.push(currentPair.id);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(playedIds));

            // 3. Remover da lista local
            availablePairs = availablePairs.filter(p => p.id !== currentPair.id);
            updateCounter();

            // 4. PrÃ³xima rodada
            nextRound();
        }

        function addToHistory(pair, success) {
            const item = document.createElement('div');
            item.className = 'history-item';
            
            const wordsDiv = document.createElement('div');
            wordsDiv.className = 'h-words';
            
            const mainSpan = document.createElement('span');
            mainSpan.className = 'h-main';
            mainSpan.textContent = pair.t;
            
            const subSpan = document.createElement('span');
            subSpan.className = 'h-sub';
            subSpan.textContent = `(Proibida: ${pair.f})`;

            wordsDiv.appendChild(mainSpan);
            wordsDiv.appendChild(subSpan);

            const statusSpan = document.createElement('span');
            if (success) {
                statusSpan.className = 'status-indicator status-ok';
                statusSpan.textContent = 'ACERTO';
            } else {
                statusSpan.className = 'status-indicator status-fail';
                statusSpan.textContent = 'ERRO';
            }

            item.appendChild(wordsDiv);
            item.appendChild(statusSpan);

            // Adicionar no topo
            elHistory.prepend(item);
        }

        function resetStorage() {
            if(confirm("Tem certeza? Isso apagarÃ¡ seu progresso e o histÃ³rico.")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        function showGameOver() {
            elGameArea.classList.add('hidden');
            elGameOver.classList.remove('hidden');
        }

        // Iniciar Jogo
	let db = [];
	fetch('dados.json').then(r => r.json()).then(d => { db = d; init(); });

    </script>
</body>

</html>
